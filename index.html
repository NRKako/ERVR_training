<!DOCTYPE html>
<html>
	<head>
		<meta name="apple-mobile-web-app-capable" content="yes">

		<script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
		<script src="https://npmcdn.com/aframe-event-set-component@3.0.1"></script>
		<script src="VRController.js"></script>
		<script src="debugout.js"></script>
		<script src="download.js"></script>
		<script src="jquery-3.6.0.js"></script>

		<meta content = "text/html; charset=utf-8" http-equiv="Content-Type">
		<meta content = "utf-8" http-equiv="encoding">
	</head>

  	<body>
	<!-- <a-scene id="scenes" vr-mode-ui inspector keyboard-shortcuts screenshot device-orientation-permission-ui> -->
	<a-scene id="scenes">
      
	 
		<a-assets>
			<!-- <a-entity oculus-touch-controls="hand: right" triggerdown-logging></a-entity>
			<a-entity laser-controls="hand: right"></a-entity> -->

			<a-mixin id="FeelingsIcon" geometry="primitive:plane;height:1" material="transparent:true;shader:flat" event-set__1="_event: mouseenter; geometry.height: 1.6" event-set__2="_event: mouseleave; geometry.height: 1"></a-mixin>
			<a-mixin id="TestImage" geometry="primitive:plane;height:1" material="transparent:true;shader:flat"></a-mixin>

			<video id="SphereVideo" crossorigin="anonymous" autoplay loop src="" webkit-playsinline ></video>
		</a-assets>

		<!-- <a-entity oculus-touch-controls="hand: right" triggerdown-logging></a-entity> -->
		<a-entity oculus-touch-controls laser-controls="hand: right"></a-entity>
	
		<a-sky id="WhiteSky" color="black" radius="50" visible="false">
			<a-entity position="-0.449 2.336 -6.724" rotation="0 -180 0" scale="10 10 10" geometry="primitive:plane" material="transparent:true;shader:flat"></a-entity>
		</a-sky>
	
		<a-videosphere id="vidsphere" src="#SphereVideo" geometry="radius:500"></a-videosphere>
	
		<a-entity id="fixationcross" position="0 1.5 -4" scale="0 0 0" rotation="0 0 0">
			<a-plane id = "cross" position="0 0 0" rotation="0 0 0" width="2" height=".05" color="orange"></a-plane>
			<a-plane id = "cross" position="0 0 0" rotation="0 0 0" width=".05" height="2" color="orange"></a-plane>
		</a-entity>
		
		<a-entity id="pictureboxDECREASE" position="0 2.3 -4.1" scale="0 0 0" rotation="0 0 0">
			<a-plane id = "pbox" position="0 0 0" rotation="0 0 0" width="5.2" height="5.2" color="blue"></a-plane>
		</a-entity>
		
		<a-entity id="pictureboxLOOK" position="0 2.3 -4.1" scale="0 0 0" rotation="0 0 0">
			<a-plane id = "pbox" position="0 0 0" rotation="0 0 0" width="5.2" height="5.2" color="green"></a-plane>
		</a-entity>
		
		<a-entity id="instrDECREASE" position="0 2 -4" scale="0 0 0" rotation="0 0 0">
			<a-entity id="text" material="color:#00FF80" position="0 0 -1" scale="5 5 5" text__qtext="value:DECREASE;side:double;align:center;color:white;"></a-entity>
		</a-entity>
			
		<a-entity id="instrLOOK" position="0 2 -4" scale="0 0 0" rotation="0 0 0">
			<a-entity id="text" material="color:blue" position="0 0 -1" scale="5 5 5" text__qtext="value:LOOK;side:double;align:center;color:white;"></a-entity>
		</a-entity>
		
		
		<a-entity id="FeelingsPos" position="0 1.5 -4" scale="0 0 0" rotation="0 0 0">
			<a-entity id="HowYaFeelingText" material="color:white" position="0 .95 -1" scale="5 5 5" text__qtext="value:How positive do you feel right now?;side:double;align:center;color:blue;"></a-entity>

			<a-entity id="HowYaFeelingText2" material="color:white" position="0 .70 -1" scale="5 5 5" text__qtext="value: Not at all positive--------------------------------Very positive;side:double;align:center;color:blue;"></a-entity>
			<a-entity id="HowYaFeelingText3" material="color:blue" position="0 0 -1" scale="5 5 5" text__qtext="value:1        2        3        4        5        6        7        8        9;side:double;align:center;color:blue;"></a-entity>

			<a-plane mixin="FeelingsIcon" onmousedown="log1()" position="-2.3 0 -1" scale = ".5 1 1" color="#FF8C00"></a-plane>
			<a-plane mixin="FeelingsIcon" onmousedown="log2()" position="-1.725 0 -1" scale = ".5 1 1" color="#EC7F0F"></a-plane>
			<a-plane mixin="FeelingsIcon" onmousedown="log3()" position="-1.15 0 -1" scale = ".5 1 1" color="#D9711F"></a-plane>
			<a-plane mixin="FeelingsIcon" onmousedown="log4()" position="-0.575 0 -1" scale = ".5 1 1" color="#C6642E"></a-plane>
			<a-plane mixin="FeelingsIcon" onmousedown="log5()" position="0 0 -1" scale = ".5 1 1" color="#B4573D"></a-plane>
			<a-plane mixin="FeelingsIcon" onmousedown="log6()" position=".575 0 -1" scale = ".5 1 1" color="#A1494C"></a-plane>
			<a-plane mixin="FeelingsIcon" onmousedown="log7()" position="1.15 0 -1" scale = ".5 1 1" color="#8E3C5C"></a-plane>
			<a-plane mixin="FeelingsIcon" onmousedown="log8()" position="1.725 0 -1" scale = ".5 1 1" color="#7B2E6B"></a-plane>
			<a-plane mixin="FeelingsIcon" onmousedown="log9()" position="2.3 0 -1" scale = ".5 1 1" color="#68217A"></a-plane>
        </a-entity>
		
		<a-entity id="FeelingsNeg" position="0 1.5 -4" scale="0 0 0" rotation="0 0 0">
			<a-entity id="HowYaFeelingText" material="color:white" position="0 -.95 -1" scale="5 5 5" text__qtext="value:How negative do you feel right now?;side:double;align:center;color:green;"></a-entity>

			<a-entity id="HowYaFeelingText2" material="color:white" position="0 -.70 -1" scale="5 5 5" text__qtext="value: Not at all negative------------------------------Very negative;side:double;align:center;color:green;"></a-entity>
			<a-entity id="HowYaFeelingText3" material="color:green" position="0 0 -1" scale="5 5 5" text__qtext="value:1        2        3        4        5        6        7        8        9;side:double;align:center;color:green;"></a-entity>

			<a-plane mixin="FeelingsIcon" onmousedown="log1()" position="-2.3 0 -1" scale=".5 1 1" color="#FF8C00"></a-plane>
			<a-plane mixin="FeelingsIcon" onmousedown="log2()" position="-1.725 0 -1" scale = ".5 1 1" color="#EC7F0F"></a-plane>
			<a-plane mixin="FeelingsIcon" onmousedown="log3()" position="-1.15 0 -1" scale = ".5 1 1" color="#D9711F"></a-plane>
			<a-plane mixin="FeelingsIcon" onmousedown="log4()" position="-0.575 0 -1" scale = ".5 1 1" color="#C6642E"></a-plane>
			<a-plane mixin="FeelingsIcon" onmousedown="log5()" position="0 0 -1" scale = ".5 1 1" color="#B4573D"></a-plane>
			<a-plane mixin="FeelingsIcon" onmousedown="log6()" position=".575 0 -1" scale = ".5 1 1" color="#A1494C"></a-plane>
			<a-plane mixin="FeelingsIcon" onmousedown="log7()" position="1.15 0 -1" scale = ".5 1 1" color="#8E3C5C"></a-plane>
			<a-plane mixin="FeelingsIcon" onmousedown="log8()" position="1.725 0 -1" scale = ".5 1 1" color="#7B2E6B"></a-plane>
			<a-plane mixin="FeelingsIcon" onmousedown="log9()" position="2.3 0 -1" scale = ".5 1 1" color="#68217A"></a-plane>
        </a-entity>
	
    	<a-entity camera="active: true" look-controls></a-entity>																							
		
    </a-scene>

	<script>
		"use strict";
    	$(document).ready(() => {
			var images = [
				{
					"imgNum": 0,
					"imgName": "01-1052-LOOK.jpg",
					"imgURL": "https://testervr.s3.us-west-1.amazonaws.com/training_stimuli/1052.jpg"
				}, {
					"imgNum": 1,
					"imgName": "02-1270-DECR.jpg",
					"imgURL": "https://testervr.s3.us-west-1.amazonaws.com/training_stimuli/1270.jpg"
				}, {
					"imgNum": 2,
					"imgName": "03-212-DECR.jpg",
					"imgURL": "https://testervr.s3.us-west-1.amazonaws.com/training_stimuli/2120.jpg"
				}, {
					"imgNum": 3,
					"imgName": "04-5740-LOOK.jpg",
					"imgURL": "https://testervr.s3.us-west-1.amazonaws.com/training_stimuli/5740.jpg"
				}, {
					"imgNum": 4,
					"imgName": "05-7006-LOOK.jpg",
					"imgURL": "https://testervr.s3.us-west-1.amazonaws.com/training_stimuli/7006.jpg"
				}
			]
	
			// var p1 = document.getElementById('p1');
			// var p2 = document.getElementById('p2');
			// var p3 = document.getElementById('p3');
			// var p4 = document.getElementById('p4');
			// var p5 = document.getElementById('p5');
			// var p6 = document.getElementById('p6');
			// var p7 = document.getElementById('p7');
			// var p8 = document.getElementById('p8');
			// var p9 = document.getElementById('p9');

			// var n1 = document.getElementById('n1');
			// var n2 = document.getElementById('n2');
			// var n3 = document.getElementById('n3');
			// var n4 = document.getElementById('n4');
			// var n5 = document.getElementById('n5');
			// var n6 = document.getElementById('n6');
			// var n7 = document.getElementById('n7');
			// var n8 = document.getElementById('n8');
			// var n9 = document.getElementById('n9');
			// // video.play();

			
			// p1.addEventListener('triggerdown', logThumbstick);
			// p2.addEventListener('triggerdown', logThumbstick);
			// p3.addEventListener('triggerdown', logThumbstick);
			// p4.addEventListener('triggerdown', logThumbstick);
			// p5.addEventListener('triggerdown', logThumbstick);
			// p6.addEventListener('triggerdown', logThumbstick);
			// p7.addEventListener('triggerdown', logThumbstick);
			// p8.addEventListener('triggerdown', logThumbstick);
			// p9.addEventListener('triggerdown', logThumbstick);
				// },
				// function logThumbstick(evt) {
				// 	console.log(evt)
					// if (evt.detail.y > 0.95) { console.log("DOWN"); }
					// if (evt.detail.y < -0.95) { console.log("UP"); }
					// if (evt.detail.x < -0.95) { console.log("LEFT"); }
					// if (evt.detail.x > 0.95) { console.log("RIGHT"); }
				// }
			// });
			
			var bugout = new debugout();
			// var p1 = document.getElementById('p1');
			// var p2 = document.getElementById('p2');
			// var p3 = document.getElementById('p3');
			// var p4 = document.getElementById('p4');
			// var p5 = document.getElementById('p5');
			// var p6 = document.getElementById('p6');
			// var p7 = document.getElementById('p7');
			// var p8 = document.getElementById('p8');
			// var p9 = document.getElementById('p9');

			// var n1 = document.getElementById('n1');
			// var n2 = document.getElementById('n2');
			// var n3 = document.getElementById('n3');
			// var n4 = document.getElementById('n4');
			// var n5 = document.getElementById('n5');
			// var n6 = document.getElementById('n6');
			// var n7 = document.getElementById('n7');
			// var n8 = document.getElementById('n8');
			// var n9 = document.getElementById('n9');
			// p1.setAttribute("onmousedown", function() {bugout.log(1)})
			// p2.setAttribute("onmousedown", function() {bugout.log(2)})
			// p3.setAttribute("onmousedown", function() {bugout.log(3)})
			// p4.setAttribute("onmousedown", function() {bugout.log(4)})
			// p5.setAttribute("onmousedown", function() {bugout.log(5)})
			// p6.setAttribute("onmousedown", function() {bugout.log(6)})
			// p7.setAttribute("onmousedown", function() {bugout.log(7)})
			// p8.setAttribute("onmousedown", function() {bugout.log(8)})
			// p9.setAttribute("onmousedown", function() {bugout.log(9)})
			// n1.setAttribute("onmousedown", function() {bugout.log(1)})
			// n2.setAttribute("onmousedown", function() {bugout.log(2)})
			// n3.setAttribute("onmousedown", function() {bugout.log(3)})
			// n4.setAttribute("onmousedown", function() {bugout.log(4)})
			// n5.setAttribute("onmousedown", function() {bugout.log(5)})
			// n6.setAttribute("onmousedown", function() {bugout.log(6)})
			// n7.setAttribute("onmousedown", function() {bugout.log(7)})
			// n8.setAttribute("onmousedown", function() {bugout.log(8)})
			// n9.setAttribute("onmousedown", function() {bugout.log(9)})
			setTimeout(startTest, 1 * 1000);
			//Change second number equal to the number of seconds the video will last for.

			function log1() {
				bugout.log(1)
			}

			function log2() {
				bugout.log(2)
			}

			function log3() {
				bugout.log(3)
			}

			function log4() {
				bugout.log(4)
			}


			function log5() {
				bugout.log(5)
			}


			function log6() {
				bugout.log(6)
			}


			function log7() {
				bugout.log(7)
			}

			function log8() {
				bugout.log(8)
			}


			function log9() {
				bugout.log(9)
			}
			
			//#9
			function showCross() {
				var fixcross = document.getElementById('fixationcross');
				fixcross.setAttribute('scale', '1 1 1');
				setTimeout(hideCross, 9 * 1000);
			}
			
			//#10
			function hideCross() {
				var fixcross = document.getElementById('fixationcross');
				fixcross.setAttribute('scale', '0 0 0');
			}
			
			//#1
			function instruct(img, num) {
				var rnum = Math.floor(Math.random()*2);
				var skybox = document.getElementById('WhiteSky');
				var task = namelist[num-1].substring(namelist[num-1].length-4,namelist[num-1].length);
				console.log("task", task)

				if (task == 'LOOK'){
					bugout.log('LOOK');
					skybox.setAttribute('color', 'green');
					var look = document.getElementById('instrLOOK');
					look.setAttribute('scale', '5 5 5');
					setTimeout(function() {hideInstruct(img, num, 'LOOK')}, 2 * 1000);
				}
				else{
					bugout.log('DECREASE');
					skybox.setAttribute('color', 'blue');
					var decrease = document.getElementById('instrDECREASE');
					decrease.setAttribute('scale', '5 5 5');
					setTimeout(function() {hideInstruct(img, num, 'DECREASE')}, 2 * 1000);
				}
			}
			
			//#2
			function hideInstruct(img, num, inst) {
				var skybox = document.getElementById('WhiteSky');
				skybox.setAttribute('color', 'black');
				var insttxt = document.getElementById('instr' + inst);
				insttxt.setAttribute('scale', '0 0 0');
				showPicture(img, num, inst)
			}
			
			//#6
			function hideRatingNeg(num) {
				var feelindicator = document.getElementById('FeelingsNeg');
				feelindicator.setAttribute('scale', '0 0 0');
				showRatingPos(num);
			}

			//#5
			function showRatingNeg(num) {
				bugout.log('Negative Rating Image ' + num); 
				var feelindicator = document.getElementById('FeelingsNeg');
				feelindicator.setAttribute('scale', '1 1 1');
				setTimeout(function() {hideRatingNeg(num)}, 3 * 1000);
			}

			//#8
			function hideRatingPos() {
				var feelindicator = document.getElementById('FeelingsPos');
				feelindicator.setAttribute('scale', '0 0 0');
				showCross();
			}

			//#7
			function showRatingPos(num) {
				bugout.log('Positive Rating Image ' + num); 
				var feelindicator = document.getElementById('FeelingsPos');
				feelindicator.setAttribute('scale', '1 1 1');
				setTimeout(hideRatingPos, 3 * 1000);
			}		
			

			//#4
			function hidePicture(img, num, inst) {
				var picture = document.getElementById(String(img));
				var pictureborder = document.getElementById('picturebox' + inst);
				picture.setAttribute('scale', '0 0 0');
				pictureborder.setAttribute('scale', '0 0 0');
				showRatingNeg(num)
			}

			//#3
			function showPicture(img, num, inst) {			
				var pictureholder = document.getElementById(img.toString());	
				var pictureborder = document.getElementById('picturebox' + inst);
				pictureholder.setAttribute('scale', '5 5 5');
				pictureborder.setAttribute('scale', '1.2 1.2 1.2');				

				setTimeout(function() {hidePicture(img, num, inst)}, 8 * 1000);
			}
		
			var namelist = [];
			var picturelist = [];
			var picnum = 0;
			function startTest() {	
		
				images.forEach(function(img) {
					$('a-assets').append( `<img id ='k${img.imgNum}' crossorigin='anonymous' preload='auto' src='${img.imgURL}'>` );
					$('a-scene').append(`<a-entity id='p${img.imgNum}' position='0 1 -4' scale='0 0 0' rotation='0 0 0'><a-entity mixin='TestImage' position='0 0.25 0' scale = '1 1 1' material='src:#k${img.imgNum};'></a-entity> </a-entity>`);
					// let temp = "p" + picnum;
					picturelist.push(`p${img.imgNum}`);
					namelist.push(img.imgName.substring(0, img.imgName.length-4));
					picnum++;
				})
				console.log("picture list: ", picturelist, "name list: ", namelist)
		
				//pause video
				// var video = document.getElementById('SphereVideo');
				// video.pause()
				//hide video with skybox
				var skybox = document.getElementById('WhiteSky');
				skybox.setAttribute('color', 'black');
				skybox.setAttribute('visible', 'true');
				
				//needs some delay to allow images to be added to the list
				setTimeout(startToo, 1000);
			}
		
			
			function startToo() {
				picturelist.forEach(function(element) { 
						//this is the timeout for setting each new picture cycle. currently set to 25 second test cycles.
						setTimeout(function() {instruct(element, picturelist.indexOf(element)+1)}, 25 * (picturelist.indexOf(element)+1) * 1000);
					})
				//each test takes 25 seconds, with no delay in between. need an extra 25 seconds at the end for the last test to complete.
				setTimeout(function() {alert("This is the end of the VR task. Please save the data.")}, (picnum * 25 * 1000) + 25000);
			}
			
			//Below this point contains the method for ending the test and giving the data
			var nativeAlert = window.alert;

			window.alert = function(msg) {
				nativeAlert(msg);
				bugout.log('End Of Experiment');

				var currLog = bugout.getLog();
				download(currLog, "VRData.txt");
			};
				
		});
	</script>
	</body>
</html>